var e=function(){if(window.integrator)return window.integrator;var e=[],t=[],n={};const s=(e,t,s,r)=>{var o=n[e];if(!o)return;const a=window.parent;o(s,(e=>{r?r.dispatchEvent(new CustomEvent(`response.${t}`,{detail:{id:t,response:{success:!0,error:null,result:e}}})):a.postMessage({id:t,response:{success:!0,error:null,result:e}},"*")}),(e=>{r?r.dispatchEvent(new CustomEvent(`response.${t}`,{detail:{id:t,response:{success:!1,error:e,result:null}}})):a.postMessage({id:t,response:{success:!0,error:null,result}},"*")}))};return{install:function(e){const t=e?"execute":"message",n=t=>{e?s(t.detail?.payload?.method,t.detail.id,t.detail?.payload?.args,e):s(t.data?.payload?.method,t.data.id,t.data?.payload?.args)},r=e??window;return r.addEventListener(t,n),()=>{r.removeEventListener(t,n)}},installHostMessageRelay:function(){window.addEventListener("message",(t=>{var n=e.filter((e=>e.contentWindow===t.source))?.at(0);if(n){if("watch"!==t.data.action)return;for(var[s,r]of Object.entries(t.data.reactiveVariables))n.dispatchEvent(new CustomEvent(`watch.${s}`,{detail:r}))}}))},register:function(e,t){n[e]=t},unregister:function(e){n[e]&&delete n[e]},update:function(e,t){if(t)for(var[n,s]of Object.entries(e))t.dispatchEvent(new CustomEvent(`watch.${n}`,{detail:s}));else window.parent&&window.parent.postMessage({action:"watch",reactiveVariables:e},"*")},addIframeById:function(e){var t=document.getElementById(e);this.addIframe(t)},removeIframeById:function(e){var t=document.getElementById(e);this.removeIframe(t)},addWebComponent:function(e){t.push(e),Object.assign(e,{sendMessage(e){return new Promise(((t,n)=>{const s=this,r=Math.random().toString(36).substring(7);function o(e){e.detail.id===r&&(s.removeEventListener(`response.${r}`,o),t(e.detail.response))}s.addEventListener(`response.${r}`,o),s.dispatchEvent(new CustomEvent("execute",{detail:{id:r,payload:e}})),setTimeout((()=>{s.removeEventListener(`response.${r}`,o),n(new Error("Timeout waiting for child response"))}),5e3)}))}})},addIframe:function(t){e.push(t),Object.assign(t,{sendMessage(e){return new Promise(((t,n)=>{const s=this,r=Math.random().toString(36).substring(7);function o(e){e.source===s.contentWindow&&e.data.id===r&&(window.removeEventListener("message",o),t(e.data.response))}window.addEventListener("message",o),s.contentWindow.postMessage({id:r,payload:e},"*"),setTimeout((()=>{window.removeEventListener("message",o),n(new Error("Timeout waiting for child response"))}),5e3)}))}})},removeIframe:function(t){t?.sendMessage&&delete t.sendMessage;var n=e.indexOf(t);-1!==n&&e.splice(n,1)},getIframes:function(){return e},getFunctions:function(){return Object.keys(n)},getWebComponent:function(){return t}}}();window.integrator=window.integrator??e;